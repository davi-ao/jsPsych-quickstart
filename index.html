<!doctype html>
<html>
    
    <head>
        <title>Reading experiment</title>
        <!-- Load jQuery -->
        <script src="scripts/jquery.min.js"></script>
        <!-- Load the jspsych library and plugins -->
        <script src="scripts/jspsych.js"></script>
        <script src="scripts/plugins/jspsych-text.js"></script>
        <script src="scripts/plugins/jspsych-single-stim.js"></script>
        <script src="scripts/plugins/jspsych-call-function.js"></script>
        <!-- Load the stylesheet -->
        <link href="css/jspsych.css" type="text/css" rel="stylesheet"></link>
    </head>
    
    <body>
        <div id="jspsych_target"></div>
    </body>
    
    <script type="text/javascript">
        // Experiment parameters
        var n_trials_per_stimulus = 10;
        
        // Experiment Instructions
        var welcome_message = '<div id="instructions"><p>Welcome to the experiment. Press enter to begin.</p></div>';
        
        var instructions = '<div id="instructions"><h2>Visual-Spatial Task</h2><p>You will see a red dot either on the left or on the right side of a line.</p><p>Press the arrow key that corresponds to the position of the dot.</p>\
            <p>Press enter to start.</p>';

        var debrief = '<div id="instructions"><p>Thank you for participating! Press enter to continue.</p></div>';

        // Generating Random Order for Stimuli
		
		var stimuli = [
			{image: "img/left_1.png", data: { stimulus_type: "left" }},
			{image: "img/left_2.png", data: { stimulus_type: "left" }},
			{image: "img/left_3.png", data: { stimulus_type: "left" }}, 
			{image: "img/right_1.png", data: { stimulus_type: "right" }},
			{image: "img/right_2.png", data: { stimulus_type: "right" }},
			{image: "img/right_3.png", data: { stimulus_type: "right" }},
		];
        
		var trial_info = jsPsych.randomization.repeat(stimuli, n_trials_per_stimulus, true);
        
        // Define experiment blocks
        var instruction_block = {
                type: "text",
                text: [welcome_message, instructions],
                timing_post_trial: 0
            };
        
        var test_block = {
                type: "single-stim",
                stimuli: trial_info.image,
                choices: [17, 39],
                data: trial_info.data,
				timing_post_trial: function() {
					return 500;
				}
            };
            
        var debrief_block = {
                type: "text",
                text: [debrief]
            };
            
		// functions to be called
        var addLine = function() { 
            $("#jspsych_target").css("background", "url(img/bg.png) center center repeat-y");
        };
		
		var removeLine = function(){
			$("#jspsych_target").css("background", "");
		}

        // declare the blocks.
        var function_addLine = {type:'call-function', func: addLine};
		var function_removeLine = {type:'call-function', func: removeLine};
		
		function saveData(filename, filedata){
		   $.ajax({
			  type:'post',
			  cache: false,
			  url: 'php/save_data.php', // this is the path to the PHP script
			  data: {filename: filename, filedata: filedata},
			  success: function(){
				  $("#jspsych_target").html("<p><a href=\"http://localhost/jsPsych-quickstart/\">Restart experiment</a></p><p><a href=\"http://localhost/jsPsych-quickstart/immediate_recall.html\">Go to next experiment.</a></p>");
			  }
		   });
		}
		
		function start_experiment() {
			jsPsych.init({
				display_element: $('#jspsych_target'),
				experiment_structure: [instruction_block, function_addLine, test_block, function_removeLine, debrief_block],
				on_finish: function(data){
					saveData("visual-spatialTask_" + $.now() + ".csv", jsPsych.dataAPI.dataAsCSV());
				}
			});
		}
		
		jsPsych.preloadImages(trial_info.image, function() { start_experiment(); });
    </script>
</html>
